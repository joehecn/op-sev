var e=Object.defineProperty,r=Object.defineProperties,o=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,i=(r,o,l)=>o in r?e(r,o,{enumerable:!0,configurable:!0,writable:!0,value:l}):r[o]=l,n=(e,r)=>{for(var o in r||(r={}))t.call(r,o)&&i(e,o,r[o]);if(l)for(var o of l(r))a.call(r,o)&&i(e,o,r[o]);return e},d=(e,l)=>r(e,o(l));import{i as u}from"./index.4fe1307f.js";import{C as s}from"./axios.641f0188.js";import{h as p}from"./index.e79032c8.js";import{L as c,e as m,M as g,r as f,o as b,c as h,N as y,b as v,d as P,R as F,p as V,a as _,S as x,T as w,P as D,w as C}from"./vendor.86ff60f9.js";const j={name:"DialogEditDoor",props:{type:String},emits:["success"],setup(e,r){const o=c(null),l=m({visible:!1,oldForm:null,ruleForm:{ip:"",receivePort:"",sendPort:"",doorNo:"",building:"",unit:""},rules:{ip:[{required:"true",message:"IP 不能為空",trigger:["change"]}],receivePort:[{required:"true",message:"接收端口不能為空",trigger:["change"]}],sendPort:[{required:"true",message:"發送端口不能為空",trigger:["change"]}],doorNo:[{required:"true",message:"門禁編碼不能為空",trigger:["change"]}],building:[{required:"true",message:"樓號不能為空",trigger:["change"]}],unit:[{required:"true",message:"單元號不能為空",trigger:["change"]}]}});return d(n({formRef:o},g(l)),{open:e=>{l.oldForm=e;const r=Object.assign({},e);l.ruleForm=r,l.visible=!0},submitForm:()=>{o.value.validate().then((o=>{if(o)if("add"==e.type)s.put("/door/add",l.ruleForm).then((()=>{r.emit("success"),l.visible=!1})).catch((e=>{s.isAxiosError(e)?p(e):console.error(e)}));else{if(u(l.oldForm,l.ruleForm))return void(l.visible=!1);console.log("提交服务器"),s.post("/door/update",l.ruleForm).then((()=>{r.emit("success"),l.visible=!1})).catch((e=>{s.isAxiosError(e)?p(e):console.error(e)}))}}))}})}},O={class:"dialog-footer"},k=P("取 消"),S=P("確 定");j.render=function(e,r,o,l,t,a){const i=f("el-input"),n=f("el-form-item"),d=f("el-form"),u=f("el-button"),s=f("el-dialog");return b(),h(s,{title:"add"==o.type?"添加門禁":"修改門禁",modelValue:e.visible,"onUpdate:modelValue":r[8]||(r[8]=r=>e.visible=r),width:"400px"},{footer:y((()=>[v("span",O,[v(u,{onClick:r[7]||(r[7]=r=>e.visible=!1)},{default:y((()=>[k])),_:1}),v(u,{type:"primary",onClick:l.submitForm},{default:y((()=>[S])),_:1},8,["onClick"])])])),default:y((()=>[v(d,{model:e.ruleForm,rules:e.rules,ref:"formRef","label-width":"100px",class:"door-form"},{default:y((()=>[v(n,{label:"IP",prop:"ip"},{default:y((()=>[v(i,{type:"text",modelValue:e.ruleForm.ip,"onUpdate:modelValue":r[1]||(r[1]=r=>e.ruleForm.ip=r)},null,8,["modelValue"])])),_:1}),v(n,{label:"接收端口",prop:"receivePort"},{default:y((()=>[v(i,{type:"text",modelValue:e.ruleForm.receivePort,"onUpdate:modelValue":r[2]||(r[2]=r=>e.ruleForm.receivePort=r)},null,8,["modelValue"])])),_:1}),v(n,{label:"發送端口",prop:"sendPort"},{default:y((()=>[v(i,{type:"text",modelValue:e.ruleForm.sendPort,"onUpdate:modelValue":r[3]||(r[3]=r=>e.ruleForm.sendPort=r)},null,8,["modelValue"])])),_:1}),v(n,{label:"門禁編碼",prop:"doorNo"},{default:y((()=>[v(i,{type:"text",modelValue:e.ruleForm.doorNo,"onUpdate:modelValue":r[4]||(r[4]=r=>e.ruleForm.doorNo=r)},null,8,["modelValue"])])),_:1}),v(n,{label:"樓號",prop:"building"},{default:y((()=>[v(i,{type:"text",modelValue:e.ruleForm.building,"onUpdate:modelValue":r[5]||(r[5]=r=>e.ruleForm.building=r)},null,8,["modelValue"])])),_:1}),v(n,{label:"單元號",prop:"unit"},{default:y((()=>[v(i,{type:"text",modelValue:e.ruleForm.unit,"onUpdate:modelValue":r[6]||(r[6]=r=>e.ruleForm.unit=r)},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["title","modelValue"])};const E={name:"Door",components:{DialogEditDoor:j},setup(){const e=c(null),r=c(null),o=m({loading:!1,tableData:[],total:0,currentPage:1,pageSize:10,type:"add"});F((()=>{l()}));const l=()=>{o.loading=!0,s.get("/door/list").then((e=>{const r=(o.currentPage-1)*o.pageSize,l=r+o.pageSize;o.total=e.length,o.tableData=e.slice(r,l),o.loading=!1})).catch((e=>{console.error(e)}))};return d(n({tableRef:e,editItemRef:r},g(o)),{handleAdd:()=>{o.type="add",r.value.open({ip:"",receivePort:"",sendPort:"",doorNo:"",building:"",unit:""})},handleEdit:e=>{o.type="edit",r.value.open(e)},handleDelete:e=>{console.log({_id:e}),s.delete("/door/remove",{data:{_id:e}}).then((()=>{l()}))},changePage:e=>{o.currentPage=e,l()},refreshData:l})}},N=C();V("data-v-217675fb");const z={class:"header"},I=P("添加"),R=v("a",{style:{cursor:"pointer"}},"删除",-1);_();const U=N(((e,r,o,l,t,a)=>{const i=f("el-button"),n=f("el-table-column"),d=f("el-popconfirm"),u=f("el-table"),s=f("el-pagination"),p=f("el-card"),c=f("DialogEditDoor"),m=x("loading");return b(),h(D,null,[v(p,{class:"index-container"},{header:N((()=>[v("div",z,[v(i,{type:"primary",size:"small",icon:"el-icon-plus",onClick:l.handleAdd},{default:N((()=>[I])),_:1},8,["onClick"])])])),default:N((()=>[w(v(u,{ref:"tableRef",data:e.tableData,"tooltip-effect":"dark",style:{width:"100%"}},{default:N((()=>[v(n,{prop:"ip",label:"IP",width:"200"}),v(n,{prop:"receivePort",label:"接收端口",width:"200"}),v(n,{prop:"sendPort",label:"發送端口",width:"200"}),v(n,{prop:"doorNo",label:"門禁編碼",width:"200"}),v(n,{prop:"building",label:"樓號",width:"200"}),v(n,{prop:"unit",label:"單元號"}),v(n,{label:"操作",width:"100"},{default:N((e=>[v("a",{style:{cursor:"pointer","margin-right":"10px"},onClick:r=>l.handleEdit(e.row)},"修改",8,["onClick"]),v(d,{title:"确定删除吗？",onConfirm:r=>l.handleDelete(e.row._id)},{reference:N((()=>[R])),_:2},1032,["onConfirm"])])),_:1})])),_:1},8,["data"]),[[m,e.loading]]),v(s,{background:"",layout:"prev, pager, next",total:e.total,"page-size":e.pageSize,"current-page":e.currentPage,onCurrentChange:l.changePage},null,8,["total","page-size","current-page","onCurrentChange"])])),_:1}),v(c,{ref:"editItemRef",type:e.type,onSuccess:l.refreshData},null,8,["type","onSuccess"])],64)}));E.render=U,E.__scopeId="data-v-217675fb";export default E;
