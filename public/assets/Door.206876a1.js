var e=Object.defineProperty,o=Object.defineProperties,t=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,i=(o,t,r)=>t in o?e(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,n=(e,o)=>{for(var t in o||(o={}))l.call(o,t)&&i(e,t,o[t]);if(r)for(var t of r(o))a.call(o,t)&&i(e,t,o[t]);return e},d=(e,r)=>o(e,t(r));import{i as u}from"./index.503f9b21.js";import{a as s}from"./axios.2672a526.js";import{h as p}from"./index.0bd78b47.js";import{M as m,e as c,O as f,r as g,o as b,c as h,P as v,b as y,d as P,T as w,p as _,a as F,U as M,W as C,t as D,R as x,w as V}from"./vendor.8e75f880.js";import{h as S}from"./moment.08a7f518.js";const j={name:"DialogEditDoor",props:{type:String},emits:["success"],setup(e,o){const t=m(null),r=c({visible:!1,oldForm:null,ruleForm:{ip:"",doorNo:"",building:"",unit:""},rules:{ip:[{required:"true",message:"IP 不能為空",trigger:["change"]}],doorNo:[{required:"true",message:"門禁編碼不能為空",trigger:["change"]}],building:[{required:"true",message:"樓號不能為空",trigger:["change"]}],unit:[{required:"true",message:"單元號不能為空",trigger:["change"]}]}});return d(n({formRef:t},f(r)),{open:e=>{r.oldForm=e;const o=Object.assign({},e);r.ruleForm=o,r.visible=!0},submitForm:()=>{t.value.validate().then((t=>{if(t)if("add"==e.type)s.put("/door/add",r.ruleForm).then((()=>{o.emit("success"),r.visible=!1})).catch((e=>{s.isAxiosError(e)?p(e):console.error(e)}));else{if(u(r.oldForm,r.ruleForm))return void(r.visible=!1);console.log("提交服务器"),s.post("/door/update",r.ruleForm).then((()=>{o.emit("success"),r.visible=!1})).catch((e=>{s.isAxiosError(e)?p(e):console.error(e)}))}}))}})}},O={class:"dialog-footer"},R=P("取 消"),k=P("確 定");j.render=function(e,o,t,r,l,a){const i=g("el-input"),n=g("el-form-item"),d=g("el-form"),u=g("el-button"),s=g("el-dialog");return b(),h(s,{title:"add"==t.type?"添加門禁":"修改門禁",modelValue:e.visible,"onUpdate:modelValue":o[6]||(o[6]=o=>e.visible=o),width:"400px"},{footer:v((()=>[y("span",O,[y(u,{onClick:o[5]||(o[5]=o=>e.visible=!1)},{default:v((()=>[R])),_:1}),y(u,{type:"primary",onClick:r.submitForm},{default:v((()=>[k])),_:1},8,["onClick"])])])),default:v((()=>[y(d,{model:e.ruleForm,rules:e.rules,ref:"formRef","label-width":"100px",class:"door-form"},{default:v((()=>[y(n,{label:"CustomID",prop:"ip"},{default:v((()=>[y(i,{type:"text",modelValue:e.ruleForm.ip,"onUpdate:modelValue":o[1]||(o[1]=o=>e.ruleForm.ip=o)},null,8,["modelValue"])])),_:1}),y(n,{label:"門禁編碼",prop:"doorNo"},{default:v((()=>[y(i,{type:"text",modelValue:e.ruleForm.doorNo,"onUpdate:modelValue":o[2]||(o[2]=o=>e.ruleForm.doorNo=o)},null,8,["modelValue"])])),_:1}),y(n,{label:"樓號",prop:"building"},{default:v((()=>[y(i,{type:"text",modelValue:e.ruleForm.building,"onUpdate:modelValue":o[3]||(o[3]=o=>e.ruleForm.building=o)},null,8,["modelValue"])])),_:1}),y(n,{label:"單元號",prop:"unit"},{default:v((()=>[y(i,{type:"text",modelValue:e.ruleForm.unit,"onUpdate:modelValue":o[4]||(o[4]=o=>e.ruleForm.unit=o)},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["title","modelValue"])};const E={name:"Door",components:{DialogEditDoor:j},setup(){const e=m(null),o=m(null),t=c({loading:!1,doorMap:{},tableData:[],total:0,currentPage:1,pageSize:10,type:"add"});w((()=>{r()}));const r=()=>{t.loading=!0,s.get("/door/list").then((({list:e,doorMap:o})=>{const r=(t.currentPage-1)*t.pageSize,l=r+t.pageSize;t.total=e.length,t.tableData=e.slice(r,l),t.doorMap=o,t.loading=!1})).catch((e=>{console.error(e)}))};return d(n({tableRef:e,editItemRef:o},f(t)),{handleAdd:()=>{t.type="add",o.value.open({ip:"",doorNo:"",building:"",unit:""})},handleEdit:e=>{t.type="edit",o.value.open(e)},handleDelete:e=>{console.log({_id:e}),s.delete("/door/remove",{data:{_id:e}}).then((()=>{r()}))},changePage:e=>{t.currentPage=e,r()},refreshData:r,formatReceivePort:e=>{if(e&&t.doorMap[e]&&t.doorMap[e].serialPort){console.log(t.doorMap[e]);const{serialPort:{inputPortPath:o,inputPortRate:r}}=t.doorMap[e];return`${o}:${r}`}return""},formatSendPort:e=>{if(e&&t.doorMap[e]&&t.doorMap[e].serialPort){const{serialPort:{outputPortPath:o,outputPortRate:r}}=t.doorMap[e];return`${o}:${r}`}return""},formatTime:e=>{if(e&&t.doorMap[e]){const{now:o}=t.doorMap[e];return S(o).fromNow()}return""},formatState:e=>{if(e&&t.doorMap[e]&&t.doorMap[e].serialPort){const{serialPort:{state:o}}=t.doorMap[e];return o}return""},formatCount:e=>{if(e&&t.doorMap[e]){const{count:o}=t.doorMap[e];return o}return""}})}},N=V();_("data-v-dfcf65d0");const z={class:"header"},I=P("添加"),U=y("a",{style:{cursor:"pointer"}},"删除",-1);F();const q=N(((e,o,t,r,l,a)=>{const i=g("el-button"),n=g("el-table-column"),d=g("el-popconfirm"),u=g("el-table"),s=g("el-pagination"),p=g("el-card"),m=g("DialogEditDoor"),c=M("loading");return b(),h(x,null,[y(p,{class:"index-container"},{header:N((()=>[y("div",z,[y(i,{type:"primary",size:"small",icon:"el-icon-plus",onClick:r.handleAdd},{default:N((()=>[I])),_:1},8,["onClick"])])])),default:N((()=>[C(y(u,{ref:"tableRef",data:e.tableData,"tooltip-effect":"dark",style:{width:"100%"}},{default:N((()=>[y(n,{prop:"ip",label:"CustomID",width:"200"}),y(n,{label:"接收端口",width:"200"},{default:N((e=>[y("div",null,D(r.formatReceivePort(e.row.ip)),1)])),_:1}),y(n,{label:"發送端口",width:"200"},{default:N((e=>[y("div",null,D(r.formatSendPort(e.row.ip)),1)])),_:1}),y(n,{prop:"doorNo",label:"門禁編碼",width:"200"}),y(n,{prop:"building",label:"樓號",width:"200"}),y(n,{prop:"unit",label:"單元號"}),y(n,{label:"Last seen",width:"200"},{default:N((e=>[y("div",null,D(r.formatTime(e.row.ip)),1)])),_:1}),y(n,{label:"State",width:"200"},{default:N((e=>[y("div",null,D(r.formatState(e.row.ip)),1)])),_:1}),y(n,{label:"Waiting",width:"200"},{default:N((e=>[y("div",null,D(r.formatCount(e.row.ip)),1)])),_:1}),y(n,{label:"操作",width:"100"},{default:N((e=>[y("a",{style:{cursor:"pointer","margin-right":"10px"},onClick:o=>r.handleEdit(e.row)},"修改",8,["onClick"]),y(d,{title:"确定删除吗？",onConfirm:o=>r.handleDelete(e.row._id)},{reference:N((()=>[U])),_:2},1032,["onConfirm"])])),_:1})])),_:1},8,["data"]),[[c,e.loading]]),y(s,{background:"",layout:"prev, pager, next",total:e.total,"page-size":e.pageSize,"current-page":e.currentPage,onCurrentChange:r.changePage},null,8,["total","page-size","current-page","onCurrentChange"])])),_:1}),y(m,{ref:"editItemRef",type:e.type,onSuccess:r.refreshData},null,8,["type","onSuccess"])],64)}));E.render=q,E.__scopeId="data-v-dfcf65d0";export default E;
