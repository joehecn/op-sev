var e=Object.defineProperty,o=Object.defineProperties,r=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,i=(o,r,l)=>r in o?e(o,r,{enumerable:!0,configurable:!0,writable:!0,value:l}):o[r]=l,n=(e,o)=>{for(var r in o||(o={}))t.call(o,r)&&i(e,r,o[r]);if(l)for(var r of l(o))a.call(o,r)&&i(e,r,o[r]);return e},d=(e,l)=>o(e,r(l));import{i as u}from"./index.5263ff9e.js";import{C as s}from"./axios.c39f5eba.js";import{h as p}from"./index.1d35ec86.js";import{L as c,e as m,M as g,r as b,o as f,c as h,N as y,b as v,d as P,R as F,p as V,a as _,S as x,T as w,P as D,w as C}from"./vendor.504a7642.js";const j={name:"DialogEditDoor",props:{type:String},emits:["success"],setup(e,o){const r=c(null),l=m({visible:!1,oldForm:null,ruleForm:{ip:"",receivePort:"",sendPort:"",doorNo:"",building:"",unit:""},rules:{ip:[{required:"true",message:"IP 不能為空",trigger:["change"]}],receivePort:[{required:"true",message:"接收端口不能為空",trigger:["change"]}],sendPort:[{required:"true",message:"發送端口不能為空",trigger:["change"]}],doorNo:[{required:"true",message:"門禁編碼不能為空",trigger:["change"]}],building:[{required:"true",message:"樓號不能為空",trigger:["change"]}],unit:[{required:"true",message:"單元號不能為空",trigger:["change"]}]}});return d(n({formRef:r},g(l)),{open:e=>{l.oldForm=e;const o=Object.assign({},e);l.ruleForm=o,l.visible=!0},submitForm:()=>{r.value.validate().then((r=>{if(r)if("add"==e.type)s.put("/door/add",l.ruleForm).then((()=>{o.emit("success"),l.visible=!1})).catch((e=>{s.isAxiosError(e)?p(e):console.error(e)}));else{if(u(l.oldForm,l.ruleForm))return void(l.visible=!1);console.log("提交服务器"),s.post("/door/update",l.ruleForm).then((()=>{o.emit("success"),l.visible=!1})).catch((e=>{s.isAxiosError(e)?p(e):console.error(e)}))}}))}})}},O={class:"dialog-footer"},k=P("取 消"),S=P("確 定");j.render=function(e,o,r,l,t,a){const i=b("el-input"),n=b("el-form-item"),d=b("el-form"),u=b("el-button"),s=b("el-dialog");return f(),h(s,{title:"add"==r.type?"添加門禁":"修改門禁",modelValue:e.visible,"onUpdate:modelValue":o[8]||(o[8]=o=>e.visible=o),width:"400px"},{footer:y((()=>[v("span",O,[v(u,{onClick:o[7]||(o[7]=o=>e.visible=!1)},{default:y((()=>[k])),_:1}),v(u,{type:"primary",onClick:l.submitForm},{default:y((()=>[S])),_:1},8,["onClick"])])])),default:y((()=>[v(d,{model:e.ruleForm,rules:e.rules,ref:"formRef","label-width":"100px",class:"door-form"},{default:y((()=>[v(n,{label:"IP",prop:"ip"},{default:y((()=>[v(i,{type:"text",modelValue:e.ruleForm.ip,"onUpdate:modelValue":o[1]||(o[1]=o=>e.ruleForm.ip=o)},null,8,["modelValue"])])),_:1}),v(n,{label:"接收端口",prop:"receivePort"},{default:y((()=>[v(i,{type:"text",modelValue:e.ruleForm.receivePort,"onUpdate:modelValue":o[2]||(o[2]=o=>e.ruleForm.receivePort=o)},null,8,["modelValue"])])),_:1}),v(n,{label:"發送端口",prop:"sendPort"},{default:y((()=>[v(i,{type:"text",modelValue:e.ruleForm.sendPort,"onUpdate:modelValue":o[3]||(o[3]=o=>e.ruleForm.sendPort=o)},null,8,["modelValue"])])),_:1}),v(n,{label:"門禁編碼",prop:"doorNo"},{default:y((()=>[v(i,{type:"text",modelValue:e.ruleForm.doorNo,"onUpdate:modelValue":o[4]||(o[4]=o=>e.ruleForm.doorNo=o)},null,8,["modelValue"])])),_:1}),v(n,{label:"樓號",prop:"building"},{default:y((()=>[v(i,{type:"text",modelValue:e.ruleForm.building,"onUpdate:modelValue":o[5]||(o[5]=o=>e.ruleForm.building=o)},null,8,["modelValue"])])),_:1}),v(n,{label:"單元號",prop:"unit"},{default:y((()=>[v(i,{type:"text",modelValue:e.ruleForm.unit,"onUpdate:modelValue":o[6]||(o[6]=o=>e.ruleForm.unit=o)},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["title","modelValue"])};const E={name:"Door",components:{DialogEditDoor:j},setup(){const e=c(null),o=c(null),r=m({loading:!1,tableData:[],total:0,currentPage:1,pageSize:10,type:"add"});F((()=>{l()}));const l=()=>{r.loading=!0,s.get("/door/list").then((e=>{const o=(r.currentPage-1)*r.pageSize,l=o+r.pageSize;r.total=e.length,r.tableData=e.slice(o,l),r.loading=!1})).catch((e=>{console.log(e)}))};return d(n({tableRef:e,editItemRef:o},g(r)),{handleAdd:()=>{r.type="add",o.value.open({ip:"",receivePort:"",sendPort:"",doorNo:"",building:"",unit:""})},handleEdit:e=>{r.type="edit",o.value.open(e)},handleDelete:e=>{console.log({_id:e}),s.delete("/door/remove",{data:{_id:e}}).then((()=>{l()}))},changePage:e=>{r.currentPage=e,l()},refreshData:l})}},N=C();V("data-v-429abb7f");const z={class:"header"},I=P("添加"),R=v("a",{style:{cursor:"pointer"}},"删除",-1);_();const U=N(((e,o,r,l,t,a)=>{const i=b("el-button"),n=b("el-table-column"),d=b("el-popconfirm"),u=b("el-table"),s=b("el-pagination"),p=b("el-card"),c=b("DialogEditDoor"),m=x("loading");return f(),h(D,null,[v(p,{class:"index-container"},{header:N((()=>[v("div",z,[v(i,{type:"primary",size:"small",icon:"el-icon-plus",onClick:l.handleAdd},{default:N((()=>[I])),_:1},8,["onClick"])])])),default:N((()=>[w(v(u,{ref:"tableRef",data:e.tableData,"tooltip-effect":"dark",style:{width:"100%"}},{default:N((()=>[v(n,{prop:"ip",label:"IP",width:"200"}),v(n,{prop:"receivePort",label:"接收端口",width:"200"}),v(n,{prop:"sendPort",label:"發送端口",width:"200"}),v(n,{prop:"doorNo",label:"門禁編碼",width:"200"}),v(n,{prop:"building",label:"樓號",width:"200"}),v(n,{prop:"unit",label:"單元號"}),v(n,{label:"操作",width:"100"},{default:N((e=>[v("a",{style:{cursor:"pointer","margin-right":"10px"},onClick:o=>l.handleEdit(e.row)},"修改",8,["onClick"]),v(d,{title:"确定删除吗？",onConfirm:o=>l.handleDelete(e.row._id)},{reference:N((()=>[R])),_:2},1032,["onConfirm"])])),_:1})])),_:1},8,["data"]),[[m,e.loading]]),v(s,{background:"",layout:"prev, pager, next",total:e.total,"page-size":e.pageSize,"current-page":e.currentPage,onCurrentChange:l.changePage},null,8,["total","page-size","current-page","onCurrentChange"])])),_:1}),v(c,{ref:"editItemRef",type:e.type,onSuccess:l.refreshData},null,8,["type","onSuccess"])],64)}));E.render=U,E.__scopeId="data-v-429abb7f";export default E;
