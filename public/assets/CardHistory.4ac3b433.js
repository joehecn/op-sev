var e=Object.defineProperty,a=Object.defineProperties,t=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,l=(a,t,o)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[t]=o;import{h as s,e as d,F as i}from"./FileSaver.min.81b7fc4b.js";import{a as c}from"./axios.1f9a9e3a.js";import{e as p,W as g,Q as u,p as m,a as f,r as h,X as b,o as w,c as C,b as y,Y as v,t as x,w as D,d as P}from"./vendor.559dc3a1.js";import"./index.36530c03.js";const j={name:"CardHistory",setup(){const e=p({loading:!1,list:[],tableData:[],total:0,currentPage:1,pageSize:10,type:"add",doorOptions:[]});g((()=>{m()}));const m=()=>{e.loading=!0,c.get("/history/list").then((a=>{const t=(e.currentPage-1)*e.pageSize,o=t+e.pageSize;e.list=a,e.total=a.length,e.tableData=a.slice(t,o),e.loading=!1})).catch((e=>{console.error(e)}))},f=e=>s(e).format("YYYY-MM-DD HH:mm:ss");return h=((e,a)=>{for(var t in a||(a={}))r.call(a,t)&&l(e,t,a[t]);if(o)for(var t of o(a))n.call(a,t)&&l(e,t,a[t]);return e})({},u(e)),a(h,t({changePage:a=>{e.currentPage=a,m()},refreshData:m,formatTime:f,handleDownload:()=>{const a=s().format("YYYYMMDD_HHmmss"),t=e.list,o=`CardHistory_${a}.xlsx`,r=new d.exports.Workbook,n=r.addWorksheet("CardHistory");n.addRow(["舊卡","新卡","用戶名","姓名","住戶信息","時間"]),n.getColumn(1).width=24,n.getColumn(2).width=24,n.getColumn(3).width=18,n.getColumn(4).width=18,n.getColumn(5).width=18,n.getColumn(6).width=24,n.getRow(1).font={size:12,bold:!0};for(let e=0,l=t.length;e<l;e++){const{cardNo:a,newCardNo:o,username:r,realname:l,userInfo:s,createdAt:d}=t[e],i=f(d);n.addRow([a,o,r,l,s,i])}r.xlsx.writeBuffer().then((e=>{i.exports.saveAs(new Blob([e],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),o)})).catch((e=>{console.error(e)}))}}));var h}},O=D();m("data-v-7edfa305");const Y={class:"header"},z=P("導出");f();const _=O(((e,a,t,o,r,n)=>{const l=h("el-button"),s=h("el-table-column"),d=h("el-table"),i=h("el-pagination"),c=h("el-card"),p=b("loading");return w(),C(c,{class:"index-container"},{header:O((()=>[y("div",Y,[y(l,{size:"small",icon:"el-icon-download",onClick:o.handleDownload},{default:O((()=>[z])),_:1},8,["onClick"])])])),default:O((()=>[v(y(d,{data:e.tableData,"tooltip-effect":"dark",style:{width:"100%"}},{default:O((()=>[y(s,{prop:"cardNo",label:"舊卡",width:"200"}),y(s,{prop:"newCardNo",label:"新卡",width:"200"}),y(s,{prop:"username",label:"用戶名"}),y(s,{prop:"realname",label:"姓名"}),y(s,{prop:"userInfo",label:"住戶信息"}),y(s,{label:"時間",width:"200"},{default:O((e=>[y("div",null,x(o.formatTime(e.row.createdAt)),1)])),_:1})])),_:1},8,["data"]),[[p,e.loading]]),y(i,{background:"",layout:"prev, pager, next",total:e.total,"page-size":e.pageSize,"current-page":e.currentPage,onCurrentChange:o.changePage},null,8,["total","page-size","current-page","onCurrentChange"])])),_:1})}));j.render=_,j.__scopeId="data-v-7edfa305";export default j;
